{"id":"node_modules/@inrupt/solid-client-authn-browser/dist/iframe.js","dependencies":[{"name":"/Users/tdrave/demo-solid-app/node_modules/@inrupt/solid-client-authn-browser/dist/iframe.js.map","includedInParent":true,"mtime":1652099631555},{"name":"/Users/tdrave/demo-solid-app/node_modules/@inrupt/solid-client-authn-browser/src/iframe.ts","includedInParent":true,"mtime":1652099631808},{"name":"/Users/tdrave/demo-solid-app/package.json","includedInParent":true,"mtime":1652099771977},{"name":"/Users/tdrave/demo-solid-app/node_modules/@inrupt/solid-client-authn-browser/package.json","includedInParent":true,"mtime":1652099631546}],"generated":{"js":"\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.postRedirectUrlToParent = exports.setupIframeListener = exports.redirectInIframe = void 0;\nlet redirectIframe;\nfunction getRedirectIframe() {\n    if (typeof redirectIframe === \"undefined\") {\n        redirectIframe = window.document.createElement(\"iframe\");\n        redirectIframe.setAttribute(\"hidden\", \"true\");\n        redirectIframe.setAttribute(\"sandbox\", \"allow-scripts allow-same-origin\");\n    }\n    return redirectIframe;\n}\nfunction redirectInIframe(redirectUrl) {\n    const iframe = getRedirectIframe();\n    window.document.body.appendChild(iframe);\n    iframe.src = redirectUrl;\n}\nexports.redirectInIframe = redirectInIframe;\nfunction setupIframeListener(handleIframeRedirect) {\n    if (typeof window === \"undefined\") {\n        return;\n    }\n    window.addEventListener(\"message\", async (evt) => {\n        const iframe = getRedirectIframe();\n        if (evt.origin === window.location.origin &&\n            evt.source === iframe.contentWindow) {\n            if (typeof evt.data.redirectUrl === \"string\") {\n                await handleIframeRedirect(evt.data.redirectUrl);\n            }\n        }\n        if (window.document.body.contains(iframe)) {\n            window.document.body.removeChild(iframe);\n        }\n    });\n}\nexports.setupIframeListener = setupIframeListener;\nfunction postRedirectUrlToParent(redirectUrl) {\n    window.top.postMessage({\n        redirectUrl,\n    }, window.location.origin);\n}\nexports.postRedirectUrlToParent = postRedirectUrlToParent;\n"},"sourceMaps":{"js":{"version":3,"file":"iframe.js","sourceRoot":"","sources":["../src/iframe.ts"],"names":[],"mappings":";;;AAyBA,IAAI,cAAiC,CAAC;AAItC,SAAS,iBAAiB;IACxB,IAAI,OAAO,cAAc,KAAK,WAAW,EAAE;QACzC,cAAc,GAAG,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QACzD,cAAc,CAAC,YAAY,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;QAC9C,cAAc,CAAC,YAAY,CAAC,SAAS,EAAE,iCAAiC,CAAC,CAAC;KAC3E;IACD,OAAO,cAAc,CAAC;AACxB,CAAC;AASD,SAAgB,gBAAgB,CAAC,WAAmB;IAClD,MAAM,MAAM,GAAG,iBAAiB,EAAE,CAAC;IACnC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;IACzC,MAAM,CAAC,GAAG,GAAG,WAAW,CAAC;AAC3B,CAAC;AAJD,4CAIC;AAYD,SAAgB,mBAAmB,CACjC,oBAA+D;IAO/D,IAAI,OAAO,MAAM,KAAK,WAAW,EAAE;QACjC,OAAO;KACR;IACD,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,KAAK,EAAE,GAAiB,EAAE,EAAE;QAC7D,MAAM,MAAM,GAAG,iBAAiB,EAAE,CAAC;QACnC,IACE,GAAG,CAAC,MAAM,KAAK,MAAM,CAAC,QAAQ,CAAC,MAAM;YACrC,GAAG,CAAC,MAAM,KAAK,MAAM,CAAC,aAAa,EACnC;YACA,IAAI,OAAO,GAAG,CAAC,IAAI,CAAC,WAAW,KAAK,QAAQ,EAAE;gBAE5C,MAAM,oBAAoB,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;aAClD;SACF;QAED,IAAI,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;YACzC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;SAC1C;IACH,CAAC,CAAC,CAAC;AACL,CAAC;AA3BD,kDA2BC;AAMD,SAAgB,uBAAuB,CAAC,WAAmB;IAEzD,MAAM,CAAC,GAAI,CAAC,WAAW,CACrB;QACE,WAAW;KACZ,EACD,MAAM,CAAC,QAAQ,CAAC,MAAM,CACvB,CAAC;AACJ,CAAC;AARD,0DAQC","sourcesContent":["/*\n * Copyright 2022 Inrupt Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n// This is an internal variable used to share some state between `redirectInIframe`,\n// which initializes it, and `setupIframeListener`, which reads from it. It avoids\n// creating a DOM element with identifying attributes such as an ID which may clash\n// with some other element set up by the library user.\nlet redirectIframe: HTMLIFrameElement;\n\n// The iframe is dynamically created rather than on import,\n// to avoid accessing `window` when an app is doing server-side rendering:\nfunction getRedirectIframe(): HTMLIFrameElement {\n  if (typeof redirectIframe === \"undefined\") {\n    redirectIframe = window.document.createElement(\"iframe\");\n    redirectIframe.setAttribute(\"hidden\", \"true\");\n    redirectIframe.setAttribute(\"sandbox\", \"allow-scripts allow-same-origin\");\n  }\n  return redirectIframe;\n}\n\n/**\n * Redirects the browser to a provided IRI, but does such redirection in a child\n * iframe. This is used to have a front-channel interaction with the Solid Identity\n * Provider without having the user involved, and without refreshing the main window.\n *\n * @param redirectUrl The IRI to which the iframe should be redirected.\n */\nexport function redirectInIframe(redirectUrl: string): void {\n  const iframe = getRedirectIframe();\n  window.document.body.appendChild(iframe);\n  iframe.src = redirectUrl;\n}\n\n/**\n * This function sets up an event listener that will receive iframe messages.\n * It is only listening to messages coming from iframes that could have been\n * opened by the library, and expects to be posted the IRI the iframe has been\n * redirected to by the Solid Identity Provider. This way, the top window can\n * perform the backchannel exchange to the token endpoint without performing\n * the front-channel redirection.\n *\n * @param handleIframeRedirect Redirect URL sent by the iframe\n */\nexport function setupIframeListener(\n  handleIframeRedirect: (redirectUrl: string) => Promise<unknown>\n): void {\n  // If an app is doing server-side rendering, setting up an iframe listener\n  // is pointless (since there is no iframe, and there will be no expiring\n  // session to renew) and might even throw a `window` not defined error, so\n  // skip this in that case:\n  /* istanbul ignore if (window is always defined in tests) */\n  if (typeof window === \"undefined\") {\n    return;\n  }\n  window.addEventListener(\"message\", async (evt: MessageEvent) => {\n    const iframe = getRedirectIframe();\n    if (\n      evt.origin === window.location.origin &&\n      evt.source === iframe.contentWindow\n    ) {\n      if (typeof evt.data.redirectUrl === \"string\") {\n        // The top-level window handles the redirect that happened in the iframe.\n        await handleIframeRedirect(evt.data.redirectUrl);\n      }\n    }\n    // Clean up the iframe from the DOM\n    if (window.document.body.contains(iframe)) {\n      window.document.body.removeChild(iframe);\n    }\n  });\n}\n\n/**\n * This function bubbles up the result of the front-channel interaction with\n * the authorization endpoint to the parent window.\n */\nexport function postRedirectUrlToParent(redirectUrl: string): void {\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  window.top!.postMessage(\n    {\n      redirectUrl,\n    },\n    window.location.origin\n  );\n}\n"]}},"error":null,"hash":"5045e560baa84f087334d96a1f919473","cacheData":{"env":{}}}