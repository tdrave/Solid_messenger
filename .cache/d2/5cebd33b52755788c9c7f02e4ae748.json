{"id":"node_modules/@inrupt/solid-client-authn-browser/dist/login/oidc/ClientRegistrar.js","dependencies":[{"name":"/Users/tdrave/demo-solid-app/node_modules/@inrupt/solid-client-authn-browser/dist/login/oidc/ClientRegistrar.js.map","includedInParent":true,"mtime":1652099631554},{"name":"/Users/tdrave/demo-solid-app/node_modules/@inrupt/solid-client-authn-browser/src/login/oidc/ClientRegistrar.ts","includedInParent":true,"mtime":1652099631795},{"name":"/Users/tdrave/demo-solid-app/package.json","includedInParent":true,"mtime":1652099771977},{"name":"/Users/tdrave/demo-solid-app/node_modules/@inrupt/solid-client-authn-browser/package.json","includedInParent":true,"mtime":1652099631546},{"name":"@inrupt/oidc-client-ext","loc":{"line":3,"column":34,"index":111},"parent":"/Users/tdrave/demo-solid-app/node_modules/@inrupt/solid-client-authn-browser/dist/login/oidc/ClientRegistrar.js","resolved":"/Users/tdrave/demo-solid-app/node_modules/@inrupt/oidc-client-ext/dist/index.es.js"}],"generated":{"js":"\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst oidc_client_ext_1 = require(\"@inrupt/oidc-client-ext\");\nclass ClientRegistrar {\n    constructor(storageUtility) {\n        this.storageUtility = storageUtility;\n    }\n    async getClient(options, issuerConfig) {\n        var _a;\n        const [storedClientId, storedClientSecret,] = await Promise.all([\n            this.storageUtility.getForUser(options.sessionId, \"clientId\", {\n                secure: false,\n            }),\n            this.storageUtility.getForUser(options.sessionId, \"clientSecret\", {\n                secure: false,\n            }),\n        ]);\n        if (storedClientId) {\n            return {\n                clientId: storedClientId,\n                clientSecret: storedClientSecret,\n                clientType: \"dynamic\",\n            };\n        }\n        const extendedOptions = { ...options };\n        extendedOptions.registrationAccessToken =\n            (_a = extendedOptions.registrationAccessToken) !== null && _a !== void 0 ? _a : (await this.storageUtility.getForUser(options.sessionId, \"registrationAccessToken\"));\n        try {\n            const registeredClient = await (0, oidc_client_ext_1.registerClient)(extendedOptions, issuerConfig);\n            const infoToSave = {\n                clientId: registeredClient.clientId,\n            };\n            if (registeredClient.clientSecret) {\n                infoToSave.clientSecret = registeredClient.clientSecret;\n            }\n            if (registeredClient.idTokenSignedResponseAlg) {\n                infoToSave.idTokenSignedResponseAlg =\n                    registeredClient.idTokenSignedResponseAlg;\n            }\n            await this.storageUtility.setForUser(extendedOptions.sessionId, infoToSave, {\n                secure: false,\n            });\n            return registeredClient;\n        }\n        catch (error) {\n            throw new Error(`Client registration failed: [${error}]`);\n        }\n    }\n}\nexports.default = ClientRegistrar;\n"},"sourceMaps":{"js":{"version":3,"file":"ClientRegistrar.js","sourceRoot":"","sources":["../../../src/login/oidc/ClientRegistrar.ts"],"names":[],"mappings":";;AAiCA,6DAAyD;AAKzD,MAAqB,eAAe;IAClC,YAAoB,cAA+B;QAA/B,mBAAc,GAAd,cAAc,CAAiB;IAAG,CAAC;IAEvD,KAAK,CAAC,SAAS,CACb,OAAgC,EAChC,YAA2B;;QAG3B,MAAM,CACJ,cAAc,EACd,kBAAkB,EAEnB,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;YACpB,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,OAAO,CAAC,SAAS,EAAE,UAAU,EAAE;gBAC5D,MAAM,EAAE,KAAK;aACd,CAAC;YACF,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,OAAO,CAAC,SAAS,EAAE,cAAc,EAAE;gBAChE,MAAM,EAAE,KAAK;aACd,CAAC;SAKH,CAAC,CAAC;QACH,IAAI,cAAc,EAAE;YAClB,OAAO;gBACL,QAAQ,EAAE,cAAc;gBACxB,YAAY,EAAE,kBAAkB;gBAChC,UAAU,EAAE,SAAS;aACtB,CAAC;SACH;QACD,MAAM,eAAe,GAAG,EAAE,GAAG,OAAO,EAAE,CAAC;QAEvC,eAAe,CAAC,uBAAuB;YACrC,MAAA,eAAe,CAAC,uBAAuB,mCACvC,CAAC,MAAM,IAAI,CAAC,cAAc,CAAC,UAAU,CACnC,OAAO,CAAC,SAAS,EACjB,yBAAyB,CAC1B,CAAC,CAAC;QAEL,IAAI;YACF,MAAM,gBAAgB,GAAG,MAAM,IAAA,gCAAc,EAC3C,eAAe,EACf,YAAY,CACb,CAAC;YAEF,MAAM,UAAU,GAA2B;gBACzC,QAAQ,EAAE,gBAAgB,CAAC,QAAQ;aACpC,CAAC;YACF,IAAI,gBAAgB,CAAC,YAAY,EAAE;gBACjC,UAAU,CAAC,YAAY,GAAG,gBAAgB,CAAC,YAAY,CAAC;aACzD;YACD,IAAI,gBAAgB,CAAC,wBAAwB,EAAE;gBAC7C,UAAU,CAAC,wBAAwB;oBACjC,gBAAgB,CAAC,wBAAwB,CAAC;aAC7C;YACD,MAAM,IAAI,CAAC,cAAc,CAAC,UAAU,CAClC,eAAe,CAAC,SAAS,EACzB,UAAU,EACV;gBAIE,MAAM,EAAE,KAAK;aACd,CACF,CAAC;YACF,OAAO,gBAAgB,CAAC;SACzB;QAAC,OAAO,KAAK,EAAE;YACd,MAAM,IAAI,KAAK,CAAC,gCAAgC,KAAK,GAAG,CAAC,CAAC;SAC3D;IACH,CAAC;CACF;AAvED,kCAuEC","sourcesContent":["/*\n * Copyright 2022 Inrupt Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * @hidden\n * @packageDocumentation\n */\n\nimport {\n  IStorageUtility,\n  IClientRegistrar,\n  IIssuerConfig,\n  IClient,\n  IClientRegistrarOptions,\n} from \"@inrupt/solid-client-authn-core\";\nimport { registerClient } from \"@inrupt/oidc-client-ext\";\n\n/**\n * @hidden\n */\nexport default class ClientRegistrar implements IClientRegistrar {\n  constructor(private storageUtility: IStorageUtility) {}\n\n  async getClient(\n    options: IClientRegistrarOptions,\n    issuerConfig: IIssuerConfig\n  ): Promise<IClient> {\n    // If client secret and/or client id are stored in storage, use those.\n    const [\n      storedClientId,\n      storedClientSecret,\n      // storedClientName,\n    ] = await Promise.all([\n      this.storageUtility.getForUser(options.sessionId, \"clientId\", {\n        secure: false,\n      }),\n      this.storageUtility.getForUser(options.sessionId, \"clientSecret\", {\n        secure: false,\n      }),\n      // this.storageUtility.getForUser(options.sessionId, \"clientName\", {\n      //   // FIXME: figure out how to persist secure storage at reload\n      //   secure: false,\n      // }),\n    ]);\n    if (storedClientId) {\n      return {\n        clientId: storedClientId,\n        clientSecret: storedClientSecret,\n        clientType: \"dynamic\",\n      };\n    }\n    const extendedOptions = { ...options };\n    // If registration access token is stored, use that.\n    extendedOptions.registrationAccessToken =\n      extendedOptions.registrationAccessToken ??\n      (await this.storageUtility.getForUser(\n        options.sessionId,\n        \"registrationAccessToken\"\n      ));\n\n    try {\n      const registeredClient = await registerClient(\n        extendedOptions,\n        issuerConfig\n      );\n      // Save info\n      const infoToSave: Record<string, string> = {\n        clientId: registeredClient.clientId,\n      };\n      if (registeredClient.clientSecret) {\n        infoToSave.clientSecret = registeredClient.clientSecret;\n      }\n      if (registeredClient.idTokenSignedResponseAlg) {\n        infoToSave.idTokenSignedResponseAlg =\n          registeredClient.idTokenSignedResponseAlg;\n      }\n      await this.storageUtility.setForUser(\n        extendedOptions.sessionId,\n        infoToSave,\n        {\n          // FIXME: figure out how to persist secure storage at reload\n          // Otherwise, the client info cannot be retrieved from storage, and\n          // the lib tries to re-register the client on each fetch\n          secure: false,\n        }\n      );\n      return registeredClient;\n    } catch (error) {\n      throw new Error(`Client registration failed: [${error}]`);\n    }\n  }\n}\n"]}},"error":null,"hash":"156ca5f0169c1a420db253208c27cb88","cacheData":{"env":{}}}